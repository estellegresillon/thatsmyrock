<% if @album.photo_cover.present? %>
  <div class="banner-home" style="background-image: linear-gradient(-225deg, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.3) 50%), url('<%= cl_image_path @album.photo_cover, crop: :fill %>'); height: 50vh; background-position: center;">
<% else %>
  <div class="banner-home" style="background-image: linear-gradient(-225deg, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.3) 50%), url('https://media.guim.co.uk/67bfc01de64daa10687cc2c7103b9bcd93f22138/0_0_4896_3264/1000.jpg'); height: 50vh; background-position: center;">
<% end  %>

    <h1><%= @album.name %></h1>

</div>

<div class="content">
  <div class="wrap-show">
  <div class="row">
    <div class="col-xs-12 col-sm-6">
      <div class="band-description">
        <h3 class="red-title"><strong><%= @album.name %></strong></h3>
        <ul class="list-unstyled">
          <p>Artist : <strong><%= @album.artist.name %></strong> - <%= link_to "Visit their page", artist_path(@album.artist.id), class: "text-delete" %></p>
          <p>Rank : <strong><%= @album.rank %></strong></p>
          <p>Music style : <strong><%= @album.music_style %></strong></p>
          <p>Year : <strong><%= @album.year %></strong></p>
        </br>
          <h4>The album story :</h4>
          <p><%= @album.description %></p>
        </ul>
      </div>
    </div>

  <div class="player_albums">
    <script>
    (function(d, s, id) {
    var js, djs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "https://e-cdns-files.dzcdn.net/js/widget/loader.js";
     djs.parentNode.insertBefore(js, djs);
    }(document, "script", "deezer-widget-loader"));</script>
    <div class="deezer-widget-player" data-src="https://www.deezer.com/plugins/player?format=classic&autoplay=false&playlist=true&width=700&height=500&color=d70303&layout=&size=medium&type=album&id=12047960" data-scrolling="no" data-frameborder="0" data-allowTransparency="true" data-width="700" data-height="500"></div>
  </div>

<h3><%= @artist.name %> albums in our top :</h3>
<% index = 1 %>
  <% @albums.each_with_index do |album, i| %>

    <div class="card-home">
      <div class="card-content">

        <div class="card-cover">
          <% if album.photo_cover.present? %>
            <div class="card-img" style="background-image: linear-gradient(-225deg, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.3) 50%), url('<%= cl_image_path album.photo_cover, crop: :fill %>'); background-position: center, width: 20%;">
          <% else %>
            <% index =  i + 11 %>
            <% url = "https://source.unsplash.com/collection/1068/5#{index}x5#{index}" %>
            <div class="card-img" style="background-image: linear-gradient(-225deg, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.3) 50%), url('<%= url %>'); background-position: center, width: 20%;">
          <% end %>
          <div class="red-dot">
            <p class="album-rank"><%= album.rank %></p>
          </div>
           </div>
        </div>

        <div class="card-descr">
          <div class="album-name"><%= link_to album.name, album_path(album.id) %></div>
          <div class="group-name"><%= link_to album.artist.name, artist_path(album.artist.id) %></div>
          <p class="year-genre"><%= album.music_style %>, <%= album.year %></p>
          <div class="iconsindex" id='<%= "icons_#{album.id}" %>'>
            <% if user_signed_in? %>

              <% unless UserAlbum.find_by(user: current_user, album: album, status: "wishlist") || UserAlbum.find_by(user: current_user, album: album, status: "collected") %>
                <%= link_to album_user_albums_path(album, user_album: { status: "wishlist" }), method: :post, remote: :true, data: { status: 'wishlist'} do %>
                  <i data-toggle="tooltip" class="fas fa-heart" title="Add to your wishlist!"></i>
                <% end %>
              <% end %>

              <% unless UserAlbum.find_by(user: current_user, album: album, status: "collected") || UserAlbum.find_by(user: current_user, album: album, status: "wishlist") %>
                <%= link_to album_user_albums_path(album, user_album: { status: "collected" }), method: :post, remote: :true, data: { status: 'collected'} do %>
                  <i data-toggle="tooltip" class="fas fa-plus-square" title="Add to your collection!"></i>
                <% end %>
              <% end %>

            <% else %>
              <a data-toggle="tooltip" class="fas fa-heart" title="Login to add the album to your wishlist!"></a>
              <a data-toggle="tooltip" class="fas fa-plus-square" title="Login to add the album to your collection!"></a>
            <% end  %>
          </div>
        </div>
      </div>
    </div>

<% end %>

  <div class="downpage-links">
    <% if @album.previous.presence %>
      <p><%= link_to "<- Previous album", @album.previous %></p>
    <% end %>
    <div class="buttons">
      <%= link_to "Go back", "/", class: "btn-search" %>
    </div>
    <% if @album.next.presence %>
      <p><%= link_to "Next album ->", @album.next %></p>
    <% end %>
  </div>

</div>

    <!-- Button trigger modal -->
<button type="button" class="btn-modal" data-toggle="modal" data-target="#myModal">
 Recommandation
</button>
</div>
<%= render 'albums/modal' %>
